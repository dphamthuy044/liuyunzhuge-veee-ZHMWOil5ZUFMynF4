[合集 - FFmpeg开发实战(85)](https://github.com)

[1.FFmpeg开发笔记（一）搭建Linux系统的开发环境2023-04-16](https://github.com/aqi00/p/17323833.html)[2.FFmpeg开发笔记（二）搭建Windows系统的开发环境2023-04-29](https://github.com/aqi00/p/17363751.html)[3.FFmpeg开发笔记（三）FFmpeg的可执行程序介绍2024-03-09](https://github.com/aqi00/p/18062895)[4.FFmpeg开发笔记（四）FFmpeg的动态链接库介绍2024-03-10](https://github.com/aqi00/p/18062898)[5.FFmpeg开发笔记（五）更新MSYS的密钥环2024-03-16](https://github.com/aqi00/p/18062901)[6.FFmpeg开发笔记（六）如何访问Github下载FFmpeg源码2024-03-17](https://github.com/aqi00/p/18062902)[7.FFmpeg开发笔记（九）Linux交叉编译Android的x265库2024-03-30](https://github.com/aqi00/p/18078413)[8.FFmpeg开发笔记（十）Linux环境给FFmpeg集成vorbis和amr2024-03-31](https://github.com/aqi00/p/18078414)[9.FFmpeg开发笔记（十一）Windows环境给FFmpeg集成vorbis和amr2024-04-05](https://github.com/aqi00/p/18078415)[10.FFmpeg开发笔记（七）欧拉系统编译安装FFmpeg2024-03-23](https://github.com/aqi00/p/18062905)[11.FFmpeg开发笔记（八）Linux交叉编译Android的FFmpeg库2024-03-24](https://github.com/aqi00/p/18062906)[12.FFmpeg开发笔记（十二）Linux环境给FFmpeg集成libopus和libvpx2024-04-06](https://github.com/aqi00/p/18105739)[13.FFmpeg开发笔记（十三）Windows环境给FFmpeg集成libopus和libvpx2024-04-13](https://github.com/aqi00/p/18105744)[14.FFmpeg开发笔记（十四）FFmpeg音频重采样的缓存2024-04-14](https://github.com/aqi00/p/18105749)[15.FFmpeg开发笔记（十五）详解MediaMTX的推拉流2024-04-20](https://github.com/aqi00/p/18105753)[16.FFmpeg开发笔记（十六）Linux交叉编译Android的OpenSSL库2024-04-21](https://github.com/aqi00/p/18132687)[17.FFmpeg开发笔记（十七）Windows环境给FFmpeg集成字幕库libass2024-04-27](https://github.com/aqi00/p/18132702)[18.FFmpeg开发笔记（十八）FFmpeg兼容各种音频格式的播放2024-05-04](https://github.com/aqi00/p/18132704)[19.FFmpeg开发笔记（十九）FFmpeg开启两个线程分别解码音视频2024-05-05](https://github.com/aqi00/p/18161897)[20.FFmpeg开发笔记（二十）Linux环境给FFmpeg集成AVS3解码器2024-05-12](https://github.com/aqi00/p/18161901)[21.FFmpeg开发笔记（二十一）Windows环境给FFmpeg集成AVS3解码器2024-05-18](https://github.com/aqi00/p/18161908)[22.FFmpeg开发笔记（二十二）FFmpeg中SAR与DAR的显示宽高比2024-05-19](https://github.com/aqi00/p/18161912)[23.FFmpeg开发笔记（二十三）使用OBS Studio开启RTMP直播推流2024-05-26](https://github.com/aqi00/p/18199486)[24.FFmpeg开发笔记（二十四）Linux环境给FFmpeg集成AV1的编解码器2024-05-27](https://github.com/aqi00/p/18199491)[25.FFmpeg开发笔记（二十五）Linux环境给FFmpeg集成libwebp2024-06-01](https://github.com/aqi00/p/18199496)[26.FFmpeg开发笔记（二十六）Linux环境安装ZLMediaKit实现视频推流2024-06-02](https://github.com/aqi00/p/18199499)[27.FFmpeg开发笔记（二十七）解决APP无法访问ZLMediaKit的直播链接问题2024-06-08](https://github.com/aqi00/p/18199503)[28.FFmpeg开发笔记（二十八）Linux环境给FFmpeg集成libxvid2024-06-09](https://github.com/aqi00/p/18199506)[29.FFmpeg开发笔记（二十九）Windows环境给FFmpeg集成libxvid2024-06-15](https://github.com/aqi00/p/18239870)[30.FFmpeg开发笔记（三十）解析H.264码流中的SPS帧和PPS帧2024-06-16](https://github.com/aqi00/p/18239876)[31.FFmpeg开发笔记（三十一）使用RTMP Streamer开启APP直播推流2024-06-22](https://github.com/aqi00/p/18239879)[32.FFmpeg开发笔记（三十二）利用RTMP协议构建电脑与手机的直播Demo2024-06-23](https://github.com/aqi00/p/18239882)[33.FFmpeg开发笔记（三十三）分析ZLMediaKit对H.264流的插帧操作2024-06-29](https://github.com/aqi00/p/18240179)[34.FFmpeg开发笔记（三十四）Linux环境给FFmpeg集成libsrt和librist2024-06-30](https://github.com/aqi00/p/18240185)[35.FFmpeg开发笔记（三十五）Windows环境给FFmpeg集成libsrt2024-07-06](https://github.com/aqi00/p/18240192)[36.FFmpeg开发笔记（三十六）Linux环境安装SRS实现视频直播推流2024-07-07](https://github.com/aqi00/p/18240199)[37.FFmpeg开发笔记全目录（FFmpeg开发实战详解，含直播系统的搭建过程）2024-06-17](https://github.com/aqi00/p/18250735)[38.FFmpeg开发笔记（三十七）分析SRS对HLS协议里TS包的插帧操作2024-07-13](https://github.com/aqi00/p/18288623)[39.FFmpeg开发笔记（三十八）APP如何访问SRS推流的RTMP直播地址2024-07-14](https://github.com/aqi00/p/18288628)[40.FFmpeg开发笔记（三十九）给Visual Studio的C++工程集成FFmpeg2024-07-20](https://github.com/aqi00/p/18288635)[41.FFmpeg开发笔记（四十）Nginx集成rtmp模块实现RTMP推拉流2024-07-21](https://github.com/aqi00/p/18288637)[42.FFmpeg开发笔记（四十一）结合OBS与MediaMTX实现SRT直播推流2024-07-27](https://github.com/aqi00/p/18288640)[43.FFmpeg开发笔记（四十二）使用ZLMediaKit开启SRT视频直播服务2024-07-28](https://github.com/aqi00/p/18288642):[wgetcloud加速器官网下载](https://longdu.org)[44.FFmpeg开发笔记（四十三）使用SRS开启SRT协议的视频直播服务2024-08-03](https://github.com/aqi00/p/18288645)[45.FFmpeg开发笔记（四十四）毕业设计可做的几个拉满颜值的音视频APP2024-08-04](https://github.com/aqi00/p/18328118)[46.FFmpeg开发笔记（四十五）使用SRT Streamer开启APP直播推流2024-08-10](https://github.com/aqi00/p/18328119)[47.FFmpeg开发笔记（四十六）利用SRT协议构建手机APP的直播Demo2024-08-11](https://github.com/aqi00/p/18328121)[48.FFmpeg开发笔记（四十七）寒冬下安卓程序员的几个技术转型发展方向2024-08-17](https://github.com/aqi00/p/18328122)[49.FFmpeg开发笔记（四十八）从0开始搭建直播系统的开源软件架构2024-08-18](https://github.com/aqi00/p/18328123)[50.FFmpeg开发笔记（四十九）助您在毕业设计中脱颖而出的几个流行APP2024-08-31](https://github.com/aqi00/p/18328125)[51.FFmpeg开发笔记（五十）聊聊几种流媒体传输技术的前世今生2024-09-01](https://github.com/aqi00/p/18390366)[52.FFmpeg开发笔记（五十一）适合学习研究的几个音视频开源框架2024-09-07](https://github.com/aqi00/p/18390371)[53.FFmpeg开发笔记（五十二）移动端的国产视频播放器GSYVideoPlayer2024-09-08](https://github.com/aqi00/p/18390374)[54.FFmpeg开发笔记（五十三）移动端的国产直播录制工具EasyPusher2024-09-21](https://github.com/aqi00/p/18390381)[55.FFmpeg开发笔记（五十四）使用EasyPusher实现移动端的RTSP直播2024-09-22](https://github.com/aqi00/p/18390389)[56.FFmpeg开发笔记（五十五）寒冬里的安卓程序员可进阶修炼的几种姿势2024-10-12](https://github.com/aqi00/p/18450136)[57.FFmpeg开发笔记（五十六）使用Media3的Exoplayer播放网络视频2024-10-13](https://github.com/aqi00/p/18450140)[58.FFmpeg开发笔记（五十七）使用Media3的Transformer加工视频文件2024-10-16](https://github.com/aqi00/p/18450142)[59.FFmpeg开发笔记（五十八）把32位采样的MP3转换为16位的PCM音频2024-10-19](https://github.com/aqi00/p/18450146)[60.FFmpeg开发笔记（五十九）Linux编译ijkplayer的Android平台so库2024-10-23](https://github.com/aqi00/p/18450148)[61.FFmpeg开发笔记（六十）使用国产的ijkplayer播放器观看网络视频2024-10-26](https://github.com/aqi00/p/18450154)[62.FFmpeg开发笔记（六十一）Linux给FFmpeg集成H.266编码器vvenc05-25](https://github.com/aqi00/p/18895292)[63.FFmpeg开发笔记（六十二）Windows给FFmpeg集成H.266编码器vvenc06-02](https://github.com/aqi00/p/18906906)[64.FFmpeg开发笔记（六十三）FFmpeg使用vvenc把视频转为H.266编码06-07](https://github.com/aqi00/p/18916610)[65.FFmpeg开发笔记（六十四）使用国产的RedPlayer播放器观看网络视频06-08](https://github.com/aqi00/p/18916613)[66.FFmpeg开发笔记（六十五）Linux给FFmpeg集成LC3音频的编码器liblc306-14](https://github.com/aqi00/p/18928398)[67.FFmpeg开发笔记（六十六）Windows给FFmpeg集成LC3音频的编码器liblc306-15](https://github.com/aqi00/p/18928403)[68.FFmpeg开发笔记（六十七）Windows给FFmpeg集成支持RIST协议的librist06-21](https://github.com/aqi00/p/18939835)[69.FFmpeg开发笔记（六十八）Windows给FFmpeg集成AV1解码器libdav1d06-22](https://github.com/aqi00/p/18939837)[70.FFmpeg开发笔记（六十九）Windows给FFmpeg集成AV1编码器libaom06-28](https://github.com/aqi00/p/18953488)[71.FFmpeg开发笔记（七十）Windows给FFmpeg集成AV1编码器libsvtav106-29](https://github.com/aqi00/p/18953491)[72.FFmpeg开发笔记（七十一）使用国产的QPlayer2实现双播放器观看视频07-05](https://github.com/aqi00/p/18967126)[73.FFmpeg开发笔记（七十二）Linux给FFmpeg集成MPEG-5视频编解码器EVC07-06](https://github.com/aqi00/p/18967127)[74.FFmpeg开发笔记（七十三）Windows给FFmpeg集成MPEG-5视频编解码器07-12](https://github.com/aqi00/p/18980438)[75.FFmpeg开发笔记（七十四）Windows给FFmpeg集成二维码图像的编解码器07-13](https://github.com/aqi00/p/18980442)[76.FFmpeg开发笔记（七十五）使用qrencode和quirc对视频画面读写二维码07-19](https://github.com/aqi00/p/18982621)[77.FFmpeg开发笔记（七十六）使用国产SDK的播放器wlmedia渲染视频07-20](https://github.com/aqi00/p/18982631)[78.FFmpeg开发笔记（七十七）Android的开源音视频剪辑框架RxFFmpeg07-26](https://github.com/aqi00/p/18982640)[79.FFmpeg开发笔记（七十八）采用Kotlin+Compose的NextPlayer播放器07-27](https://github.com/aqi00/p/18982656)[80.FFmpeg开发笔记（七十九）专注于视频弹幕功能的国产弹弹播放器08-09](https://github.com/aqi00/p/18982657)[81.FFmpeg开发笔记（八十）使用百变魔音AiSound实现变声特效08-10](https://github.com/aqi00/p/18982658)[82.FFmpeg开发笔记（八十一）FFmpeg代码对RTSP和RTMP的推流区别10-08](https://github.com/aqi00/p/19126670)[83.FFmpeg开发笔记（八十二）使用国产直播服务器smart\_rtmpd执行推流操作10-12](https://github.com/aqi00/p/19126675)[84.FFmpeg开发笔记（八十三）国产的视频裁剪框架AndroidVideoTrimmer10-18](https://github.com/aqi00/p/19126677)

85.FFmpeg开发笔记（八十四）使用国产的librestreaming实现RTMP直播10-19

收起

​《FFmpeg开发实战：从零基础到短视频上线》一书的“10.2.2  FFmpeg向网络推流”介绍了轻量级流媒体服务器MediaMTX，通过该工具可以测试RTSP/RTMP等流媒体协议的推拉流。可是在此之前，得先有一个推流工具向MediaMTX推送视频流，这样末端的拉流程序才能从MediaMTX源源不断地拉取视频流。那么Android手机可使用librestreaming从摄像头实时采集视频信号，并向后端的MediaMTX持续推送视频数据。

librestreaming是一款基于Android的实时滤镜RTMP推流库，它使用MediaCodec API进行视频和音频编码，并使用librtmp库执行rtmp流式传输。此外，librestreaming还提供了在摄像头捕捉阶段之后和编码阶段之前实时视频滤镜的功能。
librestreaming的源码托管地址为https://github.com/lakeinchina/librestreaming（星星数1.0k），国内的镜像地址为https://gitee.com/mirrors/librestreaming，该框架的最后更新时间为2020年8月，并支持到Android 7.0。虽然librestreaming很久没有更新了，但其源码功能完备、代码也不太难，具有很高的学习和研究价值。
由于librestreaming源码的更新时间较早，为了让小海豚版本的Android Studio Dolphin能够打开它的范例工程，需要对librestreaming的App工程作如下修改：

# 一、补充gradle目录

下载完的librestreaming源码包缺少gradle目录，不能被Android Studio直接打开，需要先把其他App项目的gradle目录整个复制过来，并且打开gradle/gradle-wrapper.properties，把distributionUrl这行配置改成下面这样，表示使用6.7.1版本的Gradle

```
distributionUrl=https\://services.gradle.org/distributions/gradle-6.7.1-bin.zip
```

# 二、更新工具库的仓库位置

打开librestreaming工程的build.gradle，把里面的两处配置

```
jcenter()
google()
```

都改为以下配置：

```
// 以下四行添加阿里云的仓库地址，方便国内开发者下载相关插件
maven { url 'https://maven.aliyun.com/repository/jcenter' }
maven { url 'https://maven.aliyun.com/repository/google'}
maven { url 'https://maven.aliyun.com/repository/gradle-plugin'}
maven { url 'https://maven.aliyun.com/repository/public'}
google()
mavenCentral()
```

因为jcenter仓库已经废弃，所以改成引用国内的仓库位置。

# 三、修改模块的build.gradle

打开sample/build.gradle，先把“renderscriptTargetApi 20”这行注释，再把两处“JavaVersion.VERSION\_1\_7”改为“JavaVersion.VERSION\_1\_8”，以便适配对应的Gradle版本。
如果不这么改的话，Gradle构建时会报错“Failed to calculate the value of task ':librestreaming:compileDebugJavaWithJavac' property 'options.generatedSourceOutputDirectory'.”

# 四、把Support库迁移到AndroidX

librestreaming工程引用了支持库Support v27，但Android早已废弃Support库，转为使用AndroidX库，所以需要把支持库迁移到AndroidX。在Android Studio Dolphin的主界面依次选择顶部菜单“Refactor”→“Migrate to AndroidX”，即可将App工程的Support库迁移到AndroidX库。
完成以上三处修改后，重新编译App安装到真机上，启动后的推流配置界面如下图所示：

![librestreaming1](https://img2024.cnblogs.com/blog/729938/202510/729938-20251005161558403-2027054211.jpg)

可见在推流之前，得先输入流媒体服务器的推流地址。为此按照《FFmpeg开发实战：从零基础到短视频上线》一书的“10.2.2  FFmpeg向网络推流”说明，在电脑上启动MediaMTX，并通过命令“ipconfig /all”找到电脑位于WiFi的局域网IP。
确保手机和电脑连接了同一个WiFi，再往librestreaming的App配置界面填上MediaMTX的完整推流地址如“rtmp://192.168.\*.\*:1935/stream”，接着点击START按钮，打开推流预览界面如下图所示。

![librestreaming2](https://img2024.cnblogs.com/blog/729938/202510/729938-20251005161625136-1290942299.jpg)

点击左上角的START按钮可开始推流，点击SWAP按钮可切换前后摄像头，点击FLASH按钮可开关闪光灯。那么点击START按钮开始推流，librestreaming就把摄像头采集到的视频数据向MediaMTX推流。
然后电脑打开VLC media player，依次选择菜单：媒体→打开网络串流，在弹窗的URL栏输入对应的MediaMTX拉流地址“rtmp://192.168.\*.\*:1935/stream”如下图所示。

![librestreaming3](https://img2024.cnblogs.com/blog/729938/202510/729938-20251005161709138-1013899814.png)

确认输入无误后，单击右下角的播放按钮，此时VLC media player就自动播放来自拉流地址的视频画面如下图所示。

![librestreaming4]()

对比librestreaming的推流预览界面和VLC media player的拉流播放界面，可知手机摄像头采集到的视频信号正确传送给了电脑。

更多详细的FFmpeg开发知识参见[《FFmpeg开发实战：从零基础到短视频上线》](https://item.jd.com/14020415.html "《FFmpeg开发实战：从零基础到短视频上线》")一书。
